### **【完全版】ブログアプリ開発・公開プロジェクト要件定義書**

#### **1. プロジェクトの全体像とアーキテクチャ**

このプロジェクトの最終目標は、「**独自ドメインでアクセスできる、完全なCRUD機能を持ったブログアプリを、GCP上のLinuxサーバーで公開すること**」です。

**全体アーキテクチャ図:**

1.  **ユーザー**がブラウザで `https://(あなたの独自ドメイン)` にアクセスします。
2.  **お名前.com (DNSサーバー)** がドメイン名をGCP VMの固定IPアドレスに変換します。
3.  リクエストが **GCP VM** に届き、**Spring Bootアプリケーション**が応答します。
4.  Spring Bootは、フロントエンド(HTML/JS)とバックエンド(API)の両方を提供します。
5.  データの読み書きが必要な場合、Spring BootはVM内の **PostgreSQLデータベース** と通信します。

-----

#### **2. プロジェクトのフェーズ**

このプロジェクトを、以下の4つの明確なフェーズに分けて進めます。

  * **フェーズ1: ローカル開発 (完全なCRUD機能の実装)**
  * **フェーズ2: インフラ構築 (GCP VMと環境設定)**
  * **フェーズ3: デプロイと永続化 (VMへの配置と自動起動設定)**
  * **フェーズ4: 独自ドメイン設定 (DNS設定と公開)**

-----

#### **フェーズ1: ローカル開発 (完全なCRUD機能の実装)**

**目的:** アプリケーションの全機能を、まずは自分のPC上で完璧に動作させる。

| 分類 | 要件 | 詳細・実装内容 |
| :--- | :--- | :--- |
| **バックエンド** | **CRUD APIの完成** | 提供いただいた `konya-no-backend` のコードは、既にCRUDの口（エンドポイント）が用意されています。これをそのまま活用します。 |
| | **CORS設定 (必須)** | `WebConfig` クラスを追加し、CORSを有効化します。**これが無いと、フェーズ4で必ずエラーになります。** |
| **フロントエンド** | **記事一覧画面 (`index.html`)** | ・全記事を一覧表示する。\<br\>・各記事に「編集」「削除」ボタンを配置する。\<br\>・「新規投稿」ボタンを配置する。 |
| | **CRUD操作の実装 (`script.js`)** | ・**Create:** 「新規投稿」ボタンで投稿フォームを表示し、`POST /api/articles` を呼び出す。 \<br\>・**Read:** ページ読み込み時に `GET /api/articles` を呼び出し、記事一覧を描画する。\<br\>・**Update:** 「編集」ボタンで既存内容をフォームに入れ、`PUT /api/articles/{id}` を呼び出す。\<br\>・**Delete:** 「削除」ボタンで確認ダイアログを表示し、`DELETE /api/articles/{id}` を呼び出す。 |

-----

#### **フェーズ2: インフラ構築 (GCP VMと環境設定)**

**目的:** アプリケーションを配置するための、クリーンで堅牢なLinuxサーバー環境をGCP上に構築する。

| 分類 | 要件 | 詳細・設定内容 |
| :--- | :--- | :--- |
| **VMインスタンス** | **VMの作成** | ・**マシンタイプ:** `e2-small`\<br\>・**OS:** Ubuntu 22.04 LTS |
| | **静的IPアドレスの予約** | VMに**静的（固定）な外部IPアドレス**を割り当て、予約します。**独自ドメイン設定に必須です。** |
| **ネットワーク** | **ファイアウォール設定** | GCPのファイアウォールで、`tcp:8080` (アプリ用) と `tcp:22` (SSH接続用) の穴あけ（許可ルール作成）を行います。 |
| **環境構築** | **必須ソフトウェアの導入** | SSHでVMに接続し、`apt` コマンドで **OpenJDK, PostgreSQL, Git, Gradle** をインストールします。 |
| **データベース** | **DBとユーザーの作成** | `psql` コマンドでPostgreSQLを操作し、アプリ用のデータベース（例: `blog_db`）とユーザー（例: `blog_user`）を作成します。 |

-----

#### **フェーズ3: デプロイと永続化 (VMへの配置と自動起動設定)**

**目的:** 完成したアプリをVM上に配置し、サーバーが再起動しても自動で動き続けるように設定する。

| 分類 | 要件 | 詳細・手順 |
| :--- | :--- | :--- |
| **アプリケーション配置** | **ビルドと設定** | 1. VM上で `git clone` してソースコードを配置。\<br\>2. `application.properties` をVMのDB設定に合わせて修正。\<br\>3. `./gradlew clean build` で `.jar` ファイルを生成。 |
| **永続化 (Linux学習)** | **systemdによるサービス化** | `java -jar` コマンドを直接実行するのではなく、**systemdのサービスとして登録**します。これにより、\<br\>・VM起動時にアプリが自動起動する。\<br\>・何らかの原因でアプリが停止しても自動で再起動する。\<br\>・`systemctl status myapp` のように、プロとして使える起動・停止・状態確認コマンドが使えるようになります。 |

-----

#### **フェーズ4: 独自ドメイン設定 (DNS設定と公開)**

**目的:** `http://(IPアドレス):8080` のような無機質なURLではなく、取得した独自ドメインでアプリを世界に公開する。

| 分類 | 要件 | 詳細・設定手順 |
| :--- | :--- | :--- |
| **DNS設定** | **Aレコードの登録** | 1. **お名前.com** の管理画面にログインします。\<br\>2. ドメインのDNS設定画面を開きます。\<br\>3. 新しいレコードを追加します。\<br\>   ・**タイプ:** `A`\<br\>   ・**ホスト名:** `@` ( `your-domain.com` そのものの場合) または `blog` (`blog.your-domain.com` のようにサブドメインにしたい場合)\<br\>   ・**値/参照先:** フェーズ2で予約した**GCP VMの静的IPアドレス**\<br\>   ・**TTL:** デフォルトのまま (例: 3600) |
| **動作確認** | **疎通確認** | DNSの設定がインターネット全体に反映されるまで、数分〜数時間かかることがあります。反映後、ブラウザで `http://(あなたの独自ドメイン):8080` にアクセスし、ブログが表示されることを確認します。 |
